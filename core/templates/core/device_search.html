<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <title>–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body {
            background-color: #f5f5dc; /* –ú—è–≥–∫–∏–π –±–µ–∂–µ–≤—ã–π —Ñ–æ–Ω */
        }
        .input-group input {
            border-color: #007bff; /* –°–∏–Ω–∏–π –∫–æ–Ω—Ç—É—Ä */
        }
        .btn-primary {
            background-color: #007bff; /* –°–∏–Ω–∏–π —Ü–≤–µ—Ç */
            border-color: #007bff;
        }
        .btn-primary:hover {
            background-color: #0056b3; /* –¢–µ–º–Ω–µ–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫ */
        #autocomplete-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-top: none;
            background-color: white;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        #autocomplete-list a {
            cursor: pointer;
            padding: 8px 12px;
            display: block;
            color: #212529;
            text-decoration: none;
        }
        #autocomplete-list a.active,
        #autocomplete-list a:hover {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>

<body>
    <div class="container text-center mt-5">
        <h1 class="display-4">üì° Network Device Checker</h1>
        <p class="lead text-muted">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Ç–µ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ç–µ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, –∞ —Ç–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –¥–∞—Ç–∞—à–∏—Ç–æ–≤.</p>
    </div>

    <div class="container mt-5 text-center">
        <form method="post" id="device-search-form" autocomplete="off" style="position: relative;">
            {% csrf_token %}
            <div class="input-group w-50 mx-auto position-relative">
                <input
                    type="text"
                    id="device-search-input"
                    name="model"
                    class="form-control"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –º–æ–¥–µ–ª—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"
                    autofocus
                />
                <div id="autocomplete-list" class="list-group"></div>
            </div>
            <button type="submit" class="btn btn-primary mt-3">–ü–æ–∏—Å–∫</button>
        </form>
    </div>

    <div class="container">
        <a href="/admin/" class="btn btn-secondary position-absolute" style="top: 10px; right: 10px;">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É</a>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const input = document.getElementById('device-search-input');
        const list = document.getElementById('autocomplete-list');
        const form = document.getElementById('device-search-form');

        let currentFocus = -1;

        input.addEventListener('input', async function() {
            const val = this.value.trim();
            list.innerHTML = '';
            currentFocus = -1;

            if (!val) {
                return;
            }

            try {
                const response = await fetch(`/device_autocomplete/?q=${encodeURIComponent(val)}`);
                if (!response.ok) throw new Error('Network error');

                const data = await response.json();
                if (!data.results || !data.results.length) {
                    return;
                }

                data.results.forEach(item => {
                    const option = document.createElement('a');
                    option.href = `/device/${item.id}/`; // –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ: /device/, –Ω–µ /devices/
                    option.classList.add('list-group-item', 'list-group-item-action');
                    option.textContent = item.model;
                    option.addEventListener('click', (e) => {
                        e.preventDefault();
                        window.location.href = option.href;
                    });
                    list.appendChild(option);
                });
            } catch (e) {
                console.error('Autocomplete error:', e);
            }
        });

        input.addEventListener('keydown', function(e) {
            const items = list.querySelectorAll('a');
            if (!items.length) return;

            if (e.key === 'ArrowDown') {
                currentFocus++;
                if (currentFocus >= items.length) currentFocus = 0;
                setActive(items);
                e.preventDefault();
            } else if (e.key === 'ArrowUp') {
                currentFocus--;
                if (currentFocus < 0) currentFocus = items.length - 1;
                setActive(items);
                e.preventDefault();
            } else if (e.key === 'Enter') {
                if (currentFocus > -1) {
                    e.preventDefault();
                    items[currentFocus].click();
                }
                // –ï—Å–ª–∏ currentFocus == -1, —Ñ–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è (–ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å)
            }
        });

        function setActive(items) {
            items.forEach(i => i.classList.remove('active'));
            if (currentFocus > -1) {
                items[currentFocus].classList.add('active');
            }
        }

        // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –ø–æ–ª—è –≤–≤–æ–¥–∞ –∏ —Å–ø–∏—Å–∫–∞
        document.addEventListener('click', function(e) {
            if (e.target !== input && !list.contains(e.target)) {
                list.innerHTML = '';
            }
        });

        // –ú–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å, —Ç.–∫. Enter —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤—ã—à–µ
        /*
        form.addEventListener('submit', function(e) {
            if (currentFocus > -1) {
                e.preventDefault();
                const items = list.querySelectorAll('a');
                if (items.length && currentFocus < items.length) {
                    window.location.href = items[currentFocus].href;
                }
            }
        });
        */
    });
    </script>
</body>

</html>
