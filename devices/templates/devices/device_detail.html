<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container my-5">

    <h1 class="mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É</h1>

    <!-- –ë–ª–æ–∫ 1: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ -->
    <div class="card mb-4">
        <div class="card-header fw-bold">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</div>
        <div class="card-body">
            <p><strong>–ú–æ–¥–µ–ª—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</strong> {{ device.model }}</p>
            <p><strong>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å:</strong> {{ device.manufacturer }}</p>
            <a href="{% url 'admin:devices_device_change' device.id %}" class="btn btn-outline-secondary btn-sm">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        </div>
    </div>

    <!-- –ë–ª–æ–∫ 2: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è -->
    <div class="card mb-4">
        <div class="card-header fw-bold">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</div>
        <div class="card-body">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É / URL</th>
                        <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                    </tr>
                </thead>
                <tbody>
                {% for doc in documentation %}
                    <tr>
                        <td>{{ doc.get_doc_type_display }}</td>
                        <td>{% if doc.status %}‚úÖ –ù–∞–π–¥–µ–Ω{% else %}‚ùå –ù–µ—Ç{% endif %}</td>
                        <td>
                            {% if doc.file_path %}
                                <a href="{{ doc.file_path.url }}" target="_blank">–°–∫–∞—á–∞—Ç—å</a>
                            {% else %}
                                ‚Äî
                            {% endif %}
                        </td>
                        <td>–õ–æ–∫–∞–ª—å–Ω–æ</td>
                    </tr>
                {% empty %}
                    <tr><td colspan="4" class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>
                {% endfor %}
                </tbody>
            </table>
            <a href="{% url 'admin:devices_documentation_add' %}" class="btn btn-outline-primary btn-sm">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</a>
        </div>
    </div>

    <!-- –ë–ª–æ–∫ 3: –õ–æ–≥–∏–Ω—ã –∏ –ø–∞—Ä–æ–ª–∏ -->
    <div class="card mb-4">
        <div class="card-header fw-bold">–õ–æ–≥–∏–Ω—ã –∏ –ø–∞—Ä–æ–ª–∏</div>
        <div class="card-body">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>–¢–∏–ø –¥–æ—Å—Ç—É–ø–∞</th>
                        <th>Login</th>
                        <th>–ü–∞—Ä–æ–ª—å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                {% for auth in auth_data %}
                    <tr>
                        <td>{{ auth.get_access_type_display }}</td>
                        <td>{{ auth.login }}</td>
                        <td>{{ auth.password }}</td>
                        <td>
                            <a href="#" class="btn btn-sm btn-outline-secondary disabled">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        </td>
                    </tr>
                {% empty %}
                    <tr><td colspan="4" class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>
                {% endfor %}
                </tbody>
            </table>
            <a href="#" class="btn btn-outline-success btn-sm">–ò–∑–≤–ª–µ—á—å –∏–∑ PDF</a>

            <form action="{% url 'extract_auth' device.id %}" method="post">
              {% csrf_token %}
              <button class="btn btn-primary" type="submit">–ò–∑–≤–ª–µ—á—å –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –∏–∑ PDF</button>
            </form>

        </div>
    </div>

    <!-- –ë–ª–æ–∫ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ -->
    <div class="mb-4">
        <p><strong>Ping:</strong> <span id="ping-status">
          {% if ping_result %}
            <span class="text-success">‚úÖ –¥–æ—Å—Ç—É–ø–µ–Ω</span>
          {% elif ping_result is not none %}
            <span class="text-danger">‚ùå –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</span>
          {% else %}
            <span class="text-muted">–Ω–µ—Ç IP-–∞–¥—Ä–µ—Å–∞</span>
          {% endif %}
        </span></p>
        <p><strong>Web:</strong> <span class="text-muted">–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞ / –æ—à–∏–±–∫–∞</span></p>
        <p><strong>CLI:</strong> <span class="text-muted">–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞ / –æ—à–∏–±–∫–∞</span></p>
    </div>

        <button id="ping-btn">–ü–∏–Ω–≥</button>
    <div id="ping-result"></div>

    <script>
document.getElementById('ping-btn').addEventListener('click', () => {
    const deviceId = {{ device.id }};
    fetch(`/device/${deviceId}/ping/`)
        .then(response => response.json())
        .then(data => {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ #ping-result (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥, –ø–æ –∂–µ–ª–∞–Ω–∏—é)
            const resultDiv = document.getElementById('ping-result');
            resultDiv.textContent = data.status;
            resultDiv.style.color = data.status.includes("–î–æ—Å—Ç—É–ø–µ–Ω") ? "green" : "red";

            // üî• –û–±–Ω–æ–≤–ª—è–µ–º –≥–∞–ª–æ—á–∫—É –≤ #ping-status
            const statusSpan = document.getElementById('ping-status');
            if (data.status.includes("–î–æ—Å—Ç—É–ø–µ–Ω")) {
                statusSpan.innerHTML = '<span class="text-success">‚úÖ –¥–æ—Å—Ç—É–ø–µ–Ω</span>';
            } else if (data.status.includes("–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω")) {
                statusSpan.innerHTML = '<span class="text-danger">‚ùå –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</span>';
            } else {
                statusSpan.innerHTML = '<span class="text-muted">–Ω–µ—Ç IP-–∞–¥—Ä–µ—Å–∞</span>';
            }
        })
        .catch(() => {
            const resultDiv = document.getElementById('ping-result');
            resultDiv.textContent = "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ";
            resultDiv.style.color = "orange";

            const statusSpan = document.getElementById('ping-status');
            statusSpan.innerHTML = '<span class="text-warning">‚ö† –æ—à–∏–±–∫–∞</span>';
        });
});
</script>

<p><strong>Web:</strong> <span id="web-status" class="text-muted">–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞ / –æ—à–∏–±–∫–∞</span></p>
<button id="web-btn" class="btn btn-outline-primary btn-sm">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Web</button>
<div id="web-result" class="mt-2 small text-muted"></div>

    <script>
document.getElementById('web-btn').addEventListener('click', () => {
    const deviceId = {{ device.id }};
    fetch(`/device/${deviceId}/webcheck/`)
        .then(response => response.json())
        .then(data => {
            const statusSpan = document.getElementById('web-status');
            const resultDiv = document.getElementById('web-result');

            if (data.status.includes("–î–æ—Å—Ç—É–ø–µ–Ω")) {
                statusSpan.textContent = "‚úÖ –¥–æ—Å—Ç—É–ø–µ–Ω";
                statusSpan.className = "text-success";
            } else {
                statusSpan.textContent = "‚ùå –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω";
                statusSpan.className = "text-danger";
            }

            resultDiv.textContent = data.status;
        })
        .catch(() => {
            const statusSpan = document.getElementById('web-status');
            statusSpan.textContent = "‚ö† –æ—à–∏–±–∫–∞";
            statusSpan.className = "text-warning";

            const resultDiv = document.getElementById('web-result');
            resultDiv.textContent = "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ.";
        });
});
</script>



   <!-- –ë–ª–æ–∫ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π -->
    <div class="card mb-4">
        <div class="card-header fw-bold">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π</div>
        <div class="card-body">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>–§—É–Ω–∫—Ü–∏—è</th>
                        <th>–£–∫–∞–∑–∞–Ω–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏</th>
                        <th>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</th>
                        <th>CLI-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞</th>
                        <th>Web-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞</th>
                    </tr>
                </thead>
                <tbody>
                {% for f in features %}
                    <tr>
                        <td>
                          {{ f.name }}
                          <br>
                          <a href="{% url 'feature_method' f.id %}" class="small text-decoration-none">–ú–µ—Ç–æ–¥–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</a>
                        </td>
                        <td>{% if f.doc_reference %}–î–∞{% else %}–ù–µ—Ç{% endif %}</td>
                        <td>{% if f.supported %}‚úÖ{% else %}‚ùå{% endif %}</td>
                        <td>
                            {% if f.config_cli %}
                                <code>{{ f.config_cli|truncatewords:10 }}</code>
                            {% else %}
                                ‚Äî
                            {% endif %}
                        </td>
                        <td>
                            {% if f.config_web %}
                                <code>{{ f.config_web|truncatewords:10 }}</code>
                            {% else %}
                                ‚Äî
                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr><td colspan="5" class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>


</div>
</body>
</html>
