<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Результаты по устройству</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container my-5">

    <h1 class="mb-4">Результаты по устройству</h1>

    <!-- Блок 1: Информация об устройстве -->
    <div class="card mb-4">
        <div class="card-header fw-bold">Информация об устройстве</div>
        <div class="card-body">
            <p><strong>Модель устройства:</strong> {{ device.model }}</p>
            <p><strong>Производитель:</strong> {{ device.manufacturer }}</p>
            <a href="{% url 'admin:devices_device_change' device.id %}" class="btn btn-outline-secondary btn-sm">Редактировать</a>
        </div>
    </div>

    <!-- Блок 2: Документация -->
    <div class="card mb-4">
        <div class="card-header fw-bold">Документация</div>
        <div class="card-body">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Тип документа</th>
                        <th>Статус</th>
                        <th>Путь к файлу / URL</th>
                        <th>Источник</th>
                    </tr>
                </thead>
                <tbody>
                {% for doc in documentation %}
                    <tr>
                        <td>{{ doc.get_doc_type_display }}</td>
                        <td>{% if doc.status %}✅ Найден{% else %}❌ Нет{% endif %}</td>
                        <td>
                            {% if doc.file_path %}
                                <a href="{{ doc.file_path.url }}" target="_blank">Скачать</a>
                            {% else %}
                                —
                            {% endif %}
                        </td>
                        <td>Локально</td>
                    </tr>
                {% empty %}
                    <tr><td colspan="4" class="text-muted">Нет данных</td></tr>
                {% endfor %}
                </tbody>
            </table>
            <a href="{% url 'admin:devices_documentation_add' %}" class="btn btn-outline-primary btn-sm">Загрузить документ</a>
        </div>
    </div>

    <!-- Блок 3: Логины и пароли -->
    <div class="card mb-4">
        <div class="card-header fw-bold">Логины и пароли</div>
        <div class="card-body">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Тип доступа</th>
                        <th>Login</th>
                        <th>Пароль</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                {% for auth in auth_data %}
                    <tr>
                        <td>{{ auth.get_access_type_display }}</td>
                        <td>{{ auth.login }}</td>
                        <td>{{ auth.password }}</td>
                        <td>
                            <a href="#" class="btn btn-sm btn-outline-secondary disabled">Редактировать</a>
                        </td>
                    </tr>
                {% empty %}
                    <tr><td colspan="4" class="text-muted">Нет данных</td></tr>
                {% endfor %}
                </tbody>
            </table>
            <a href="#" class="btn btn-outline-success btn-sm">Извлечь из PDF</a>
        </div>
    </div>

    <!-- Блок 4: Проверка доступности -->
    <div class="mb-4">
        <p><strong>Ping:</strong>
          {% if ping_result %}
            <span class="text-success">✅ доступен</span>
          {% elif ping_result is not none %}
            <span class="text-danger">❌ недоступен</span>
          {% else %}
            <span class="text-muted">нет IP-адреса</span>
          {% endif %}
        </p>
        <p><strong>Web:</strong> <span class="text-muted">авторизация успешна / ошибка</span></p>
        <p><strong>CLI:</strong> <span class="text-muted">авторизация успешна / ошибка</span></p>
    </div>

        <button id="ping-btn">Пинг</button>
    <div id="ping-result"></div>

    <script>
    document.getElementById('ping-btn').addEventListener('click', () => {
        const deviceId = {{ device.id }};
        fetch(`/device/${deviceId}/ping/`)
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('ping-result');
                resultDiv.textContent = data.status;
                resultDiv.style.color = data.status.includes("Доступен") ? "green" : "red";
            })
            .catch(() => {
                const resultDiv = document.getElementById('ping-result');
                resultDiv.textContent = "Ошибка при проверке";
                resultDiv.style.color = "orange";
            });
    });
    </script>


   <!-- Блок 5: Проверка функций -->
    <div class="card mb-4">
        <div class="card-header fw-bold">Проверка функций</div>
        <div class="card-body">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Функция</th>
                        <th>Указана в документации</th>
                        <th>Поддержка</th>
                        <th>CLI-настройка</th>
                        <th>Web-настройка</th>
                    </tr>
                </thead>
                <tbody>
                {% for f in features %}
                    <tr>
                        <td>
                          {{ f.name }}
                          <br>
                          <a href="{% url 'feature_method' f.id %}" class="small text-decoration-none">Методика тестирования</a>
                        </td>
                        <td>{% if f.doc_reference %}Да{% else %}Нет{% endif %}</td>
                        <td>{% if f.supported %}✅{% else %}❌{% endif %}</td>
                        <td>
                            {% if f.config_cli %}
                                <code>{{ f.config_cli|truncatewords:10 }}</code>
                            {% else %}
                                —
                            {% endif %}
                        </td>
                        <td>
                            {% if f.config_web %}
                                <code>{{ f.config_web|truncatewords:10 }}</code>
                            {% else %}
                                —
                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr><td colspan="5" class="text-muted">Нет данных</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>


</div>
</body>
</html>
